window.pi="undefined"!=typeof pi?window.pi:{};window.pi.data="undefined"!=typeof window.pi.data?window.pi.data:{};
window.pi.data.ObservableObject=kendo.data.ObservableObject.extend({exists:function(a){return"undefined"!=typeof this[a]},get:function(a,b){var c=kendo.data.ObservableObject.fn.get.apply(this,arguments);return void 0!=c?c:b},set:function(a,b){if("object"==typeof a){a.toJSON&&(a=a.toJSON());if(a.constructor==Object){var c=a,d="boolean"==typeof b?b:!0;for(a in c)!d&&this.exists(a)||this.set(a,c[a])}return this}kendo.data.ObservableObject.fn.set.apply(this,arguments);return this.get(a)},remove:function(a){var b=
a.split(".");a=b.pop();if(b=this.get(b.join(".")))this.set(a,null),delete b[a];return this},removeAll:function(){this.forEach(function(a,b){this.remove(b)});return this},bind:function(a,b,c,d){var f,g=this,l="string"===typeof a?[a]:a,n="function"===typeof b;this instanceof kendo.data.ObservableObject&&kendo.data.ObservableObject.fn.bind.apply(this,arguments);this instanceof kendo.data.ObservableArray&&kendo.data.ObservableArray.fn.bind.apply(this,arguments);"undefined"==typeof d&&(d=c?!1:!0);if(d)for(var k=
0;k<l.length;k++)switch(f=n?b:b[l[k]],l[k]){case "set":g.forEach(function(a,b){f.apply(g,[{field:b,value:a,sender:g,_defaultPrevented:!1,preventDefault:function(){},isDefaultPrevented:!1}])});break;case "change":g.forEach(function(a,b){f.apply(g,[{field:b,sender:g,_defaultPrevented:!1,preventDefault:function(){},isDefaultPrevented:!1}])})}return this}});window.pi.data.ObservableArray=kendo.data.ObservableArray.extend({removeAll:function(){for(;this.length;)this.shift();return this},bind:pi.data.ObservableObject.prototype.bind});
window.pi.observable=function(a){a=a||{};if(a.constructor==Array)return new pi.data.ObservableArray(a);if(!(a instanceof pi.data.ObservableObject||a instanceof pi.data.ObservableArray))return new pi.data.ObservableObject(a)};pi="undefined"!=typeof pi?pi:{};pi.console=pi.observable([]);
pi.log=function(a,b,c){try{"object"!=typeof a?a={message:a,category:c,type:b}:a.toJSON&&(a=a.toJSON());void 0==a.type&&(a.type=b||"");void 0==a.category&&(a.category=c||"");a.modal&&modal.alert&&modal.alert(a.title||a.event||a.category||"",a.message,"error"==a.type?"sad":"happy");if(a.message)switch(a.type.toLowerCase()){case "error":case "e":a.message="[ERROR] "+a.message;break;case "info":case "i":a.message="[INFO] "+a.message;break;case "warning":case "w":a.message="[WARNING] "+a.message;break;
case "debug":case "d":a.message="[DEBUG] "+a.message}a.category.length&&(a.message=a.category.toUpperCase()+": "+a.message);pi.console?pi.console.push(a):"undefined"!=typeof window.console&&window.console.log(a.message)}catch(d){pi.console?pi.console.push(d):"undefined"!=typeof window.console&&window.console.log(d.message)}};
pi.console.bind("change",function(a){switch(a.action){case "add":for(var b=0;b<a.items.length;b++)try{if("object"!=typeof a.items[b])this.splice(a.index+b,1,{message:a.items[b].toString()});else if(a.items[b]instanceof Error)this.splice(a.index+b,1,{type:"Error",name:a.items[b].name||"",event:a.items[b].event||"",message:a.items[b].xhr?JSON.parse(a.xhr.responseText).message:a.items[b].message||"",description:a.items[b].description||"",keys:Object.keys?Object.keys(a.items[b]):"",stack:a.items[b].stack||
""});else if(a.items[b].xhr){var c=a.items[b].xhr,d=JSON.parse(c.responseText);d.status=c.status;d.statusText=c.statusText;d.readyState=c.readyState;a.items[b].name&&(d.name=a.items[b].name);a.items[b].event&&(d.event=a.items[b].event);this.splice(a.index+b,1,d)}else switch(a.items[b].type=void 0!=a.items[b].type?a.items[b].type:"",a.items[b].type.toLowerCase()){case "error":case "e":a.items[b].type="Error";console.log(JSON.stringify(a.items[b]));break;case "debug":case "d":a.items[b].type="Debug";
console.log(JSON.stringify(a.items[b]));break;case "warning":case "w":a.items[b].type="Warning";console.log(a.items[b].message);break;default:a.items[b].type="Info",console.log(a.items[b].message)}}catch(f){console.log({message:f.message,stack:"undefined"!=typeof f.stack?f.stack.toString():""}.toString())}}});pi="undefined"!=typeof pi?pi:{};pi.ui=pi.ui||{};pi.mobile=pi.mobile||{};pi.mobile.ui=pi.mobile.ui||{};
pi.ui.Widget={init:function(a,b){pi.ui.Widget.attributeOptions.apply(this,arguments);pi.ui.Widget.fn.init.apply(this,arguments)},attributeOptions:function(a,b){b=b||{};a=$(a);if(a[0].attributes){$.extend(b,pi.ui.Widget.attributeTemplate.call(this,a.attr("data")));for(var c=0,d;c<a[0].attributes.length;c++){d=a[0].attributes[c].name;if("data-"==d.substr(0,5)){switch(d){case "data-source":case "data-text-field":case "data-value-field":break;default:d=d.substr(5)}d=d.split("-");for(var f=1;f<d.length;f++)d[f]=
d[f].charAt(0).toUpperCase()+d[f].substr(1);d=d.join("")}else switch(d){case "id":case "placeholder":case "height":case "width":case "multiple":break;default:continue}b[d]=pi.ui.Widget.attributeTemplate.call(this,b[d]||a[0].attributes[c].value)}}return b},attributeTemplateRegEx:/#=?([^#]*)#/,attributeTemplate:function(a){var b,c;if("string"==typeof a)for(RegExp.lastIndex=0;b=a.match(pi.ui.Widget.attributeTemplateRegEx);){try{c=eval(b[1])}catch(d){c=null}if("object"!=typeof c&&"function"!=typeof c)a=
a.replace(pi.ui.Widget.attributeTemplateRegEx,c);else return c}return a}};pi.mobile.ui.View=kendo.mobile.ui.View;kendo.mobile.ui.View=pi.mobile.ui.View.extend({init:function(a,b){pi.ui.Widget.attributeOptions.apply(this,arguments);pi.mobile.ui.View.fn.init.apply(this,arguments)}});kendo.mobile.ui.roles.view=kendo.mobile.ui.View;pi.mobile.ui.Drawer=kendo.mobile.ui.Drawer;
kendo.mobile.ui.Drawer=pi.mobile.ui.Drawer.extend({init:function(a,b){if(b.transition){var c=b.transition.split(":");"overlay"===c[0]&&(1<c.length&&"blur"===c[1].replace(/^\s*(.*)\s*$/,"$1")?this._moveViewTo=this._overlayBlurView:this._moveViewTo=$.noop)}pi.mobile.ui.Drawer.fn.init.apply(this,arguments)},_overlayBlurView:function(a){a?(this.element.css({background:"rgba(255,255,255,0.5)"}),this.currentView.element.css({filter:"blur(4px)","-o-filter":"blur(4px)","-ms-filter":"blur(4px)","-moz-filter":"blur(4px)",
"-webkit-filter":"blur(2px)"})):(this.element.css({background:"transparent"}),this.currentView.element.css({filter:"none","-o-filter":"none","-ms-filter":"none","-moz-filter":"none","-webkit-filter":"none"}))}});kendo.mobile.ui.roles.drawer=kendo.mobile.ui.Drawer;
$(function(){$("[placeholder^=#][placeholder$=#]").each(function(a,b){$(b).attr("placeholder",pi.ui.Widget.attributeTemplate.call(b,$(b).attr("placeholder")))});$("[data-title^=#][data-title$=#]").each(function(a,b){$(b).attr("data-title",pi.ui.Widget.attributeTemplate.call(b,$(b).attr("data-title")))});$("[data-required-msg^=#][data-required-msg$=#]").each(function(a,b){$(b).attr("data-required-msg",pi.ui.Widget.attributeTemplate.call(b,$(b).attr("data-required-msg")))});$("[data-email-msg^=#][data-email-msg$=#]").each(function(a,
b){$(b).attr("data-email-msg",pi.ui.Widget.attributeTemplate.call(b,$(b).attr("data-email-msg")))});$("[data-pattern-msg^=#][data-pattern-msg$=#]").each(function(a,b){$(b).attr("data-pattern-msg",pi.ui.Widget.attributeTemplate.call(b,$(b).attr("data-pattern-msg")))})});pi=pi||{};pi.data=pi.data||{};
pi.data.DataSource={create:function(a){a=a||{};"string"===typeof a?a={source:a}:a.constructor===Array&&(a={data:a});pi.data.DataSource.configureTransport(a);pi.data.DataSource.expand(a);pi.data.DataSource.configureDebug(a);pi.data.DataSource.everliveAuthentication(a);pi.data.DataSource.configurePaging(a);pi.data.DataSource.configureSchema(a);pi.data.DataSource.configureModel(a);a=new kendo.data.DataSource(a);a.options=pi.observable(a.options);a.transport&&(a.transport.dataSource=a);pi.data.DataSource.configureSelected.apply(a);
pi.data.DataSource.configureStorage.apply(a);pi.data.DataSource.configureDefault.apply(a);pi.data.DataSource.everliveSetup.apply(a);a.options.get("selected");return a},configureTransport:function(a){void 0==a.source&&a.storage&&(a.source=a.storage);if("string"==typeof a.source&&"false"!=a.source)if(a.id||(a.id=a.source),/:\/\//.test(a.source)){a.transport=a.transport||{};a.method=(a.method||"get,put,post,delete").split(",");for(var b=0;b<a.method.length;b++)switch(a.method[b].toLowerCase()){case "read":case "get":a.transport.read=
{url:a.source,type:"GET"};break;case "create":case "put":a.transport.create={url:a.source,type:"PUT"};break;case "update":case "post":a.transport.update={url:a.source,type:"POST"};break;case "destroy":case "delete":a.transport.destroy={url:a.source,type:"DELETE"}}}else/^everlive\.(.+)/.test(a.source.toLowerCase())&&(a.source=a.source.split("."),a.type="everlive",a.batch=!1,a.transport=a.transport||{},a.transport.typeName=a.source[1],a.source=a.source.join("."))},expand:function(a){if(a.expand){"everlive"!==
a.type||a.transport.read||(a.transport.read={});if(a.transport.read.beforeSend)var b=a.transport.read.beforeSend;a.transport.read.beforeSend=function(c){c.setRequestHeader("X-Everlive-Expand",JSON.stringify(a.expand));b&&b(c)}}},configureDebug:function(a){a.debug&&a.transport&&(a.method||"get,put,post,delete").split(",").forEach(function(b,c){switch(b){case "get":case "read":b="read";break;case "put":case "update":b="update";break;case "post":case "create":b="create";break;case "delete":case "destroy":b=
"destroy"}a.transport[b]||(a.transport[b]={});if(a.transport[b].beforeSend)var d=a.transport[b].beforeSend;a.transport[b].beforeSend=function(a){a.setRequestHeader("X-Everlive-Debug",!0);d&&d(a)}})},everliveSetup:function(){"Everlive.Users"===this.options.source&&$.extend(Everlive.$.setup,{token:this.options.get("selected.access_token",null),tokenType:this.options.get("selected.token_type",null)})},everliveAuthentication:function(a){"Everlive.Users"===a.source&&(a.transport={success:function(a){var c=
this.dataSource.options.get("selected");if(a.result){for(var d in a.result)c.set(d,a.result[d]);a.result.principal_id?c.set("id",a.result.principal_id):a.result.Id&&c.set("id",a.result.Id)}else(pi||console).log(Error({name:"Everlive Login Failure",message:"Everlive returned successfully, but there was no result property!"}))},login:function(){var a=this,c=this.dataSource.options.get("selected");Everlive.$.Users.login(c.get("Username").toLowerCase(),c.get("Password")).then(function(c){a.success(c);
Everlive.$.Users.getById(c.result.principal_id).then(function(c){a.success(c)},function(a){alert(JSON.stringify(a))})},function(a){a.type=a.type||"Everlive Login Failure";a.message=a.message||"Invalid username/password combination";(pi||console).log(a)})},read:function(){var a=this;Everlive.$.Users.currentUser().then(function(c){c.result?a.success(c):a.login()},function(a){301===a.errorCode?this.login():(pi||console).log(a,"error")})},create:function(){var a=this,c=this.dataSource.options.get("selected");
c.get("Username").length&&c.get("Password").length&&Everlive.$.Users.register(c.get("Username").toLowerCase(),c.get("Password"),c.toJSON(),function(d){Everlive.$.Users.login(c.get("Username").toLowerCase(),c.get("Password"),function(c){a.success(c);Everlive.$.Users.getById(c.result.principal_id).then(a.success,function(a){alert(JSON.stringify(a))})},function(a){a.type=a.type||"Everlive Login Failure";(pi||console).log(a)})},function(a){a.type=a.type||"Everlive Account Creation Failure";(pi||console).log(a)})},
update:function(){var a=this.dataSource.options.get("selected");a.get("NewPassword")&&(a.get("NewPassword")||"")!==(a.get("Password")||"")&&Everlive.$.Users.changePassword(a.get("Username").toLowerCase(),a.get("Password"),a.get("NewPassword"),!0,function(c){a.set("Password","");delete a.NewPassword},function(a){a.type=a.type||"Everlive Password Change Failure";(pi||console).log(a)});a=a.toJSON();delete a.principal_id;delete a.access_token;delete a.token_type;Everlive.$.Users.updateSingle(a,function(a){},
function(a){a.type=a.type||"Everlive Account Update Failure";(pi||console).log(a)})},destroy:function(){var a=this.dataSource;Everlive.$.Users.logout(function(c){a.reset()},function(c){Everlive.$.setup.token=null;Everlive.$.setup.tokenType=null;a.reset()})}})},configurePaging:function(a){void 0!=a.pageSize&&void 0==a.page&&(a.page=1)},configureSchema:function(a){if("string"==typeof a.schema)switch(a.schema){case "coldfusion":case "cfquery":a.schema={data:"data",total:"total",error:function(a){alert(a.message);
return a.message},parse:function(b){var c={data:[]};void 0!=a.primarykeys&&(c.primarykey=a.primarykeys);"RECORDCOUNT"==b.COLUMNS[b.COLUMNS.length-1]&&(c.total=b.DATA[0][b.COLUMNS.length-1]);for(var d=0;d<b.DATA.length;d++){c.data[d]={};for(var f=0;f<b.COLUMNS.length;f++){var g=b.DATA[d][f];"undefined"==typeof g||null==g?g="":"string"==typeof g&&"{ts"==g.substr(0,3)?g=new Date(Date.parse(g.substr(5,g.length-7))):"true"==g?g=!0:"false"==g&&(g=!1);c.data[d][b.COLUMNS[f].toLowerCase()]=g}}return c}};
break;default:a.schema={}}"everlive"==a.type&&(a.schema=a.schema||{},a.schema.data=function(a){a=a.Result;if(a instanceof Array)for(var c=0;c<a.length;c++)a[c].id=a[c].Id,"undefined"!=typeof a[c].guid&&(a[c].uid=a[c].guid);return a})},configureModel:function(a){if(a.template){var b=$(a.template);a.schema||(a.schema={});a.schema.model=a.schema.model||{};a.schema.model.id=a.schema.model.id||[];a.schema.model.fields=a.schema.model.fields||{};a.fields=a.fields||[];"everlive"==a.type?(a.schema.model.id=
Everlive.idField,a.schema.model.fields[Everlive.idField]={type:"string"},a.fields.push({field:Everlive.idField,type:"string"})):(b.find(":input[data-name][data-id],:input[data-name][data-key=primary],:input[data-name][data-key=autonumber]").each(function(){a.schema.model.id.push($(this).attr("data-name"))}),a.schema.model.id.length?a.schema.model.id=a.schema.model.id.join(","):delete a.schema.model.id);b.find(":input[name],:input[data-name]").each(function(b){b=$(this);var d=pi.ui.Widget.attributeOptions(this,
{});delete d.bind;delete d.set;delete d.get;delete d.unbind;switch(b.prop("tagName").toLowerCase()){case "select":d.role=d.role||"select";"multiselect"==d.role.toLowerCase()||b.attr("multiple")?(d.multiple=!0,delete d.type):d.multiple=!1;delete d.role;break;case "textarea":case "input":if(null==d.type)switch(b.attr("data-type")||b.attr("type")){case "date":case "datetime":case "datetime-local":case "time":d.type="date";break;case "number":case "month":d.type="number";break;default:d.type="string"}}d.defaultValue=
b.attr("value");"undefined"==typeof d.defaultValue&&delete d.defaultValue;d.editable="false"==d.editable||0==d.editable?!1:!0;d.field=b.attr("data-name")||b.attr("name");a.schema.model.fields[d.field]||a.fields.push(d);a.schema.model.fields[d.field]=d});delete a.template}else a.schema&&!a.schema.model&&(pi||console).log("CAUTION: A DataSource without a model cannot run the sync() function, plus a lot of other things won't work either! You should supply either a 'template' option to auto-create the model, or a schema.model value.",
"i")},setGUID:function(a){if(a&&a.items)for(var b=0;b<a.items.length;b++)"undefined"==typeof a.items[b].guid?a.items[b].guid=a.items[b].uid:a.items[b].uid!=a.items[b].guid&&(a.items[b].uid=a.items[b].guid)},storeData:function(a){a=0;for(var b=this.data(),c=[];a<b.length;a++)c.push(b[a].toJSON()),c[a].dirty=b[a].dirty;this.options.storage.setItem(this.options.id,JSON.stringify(c));this.options.storage.setItem(this.options.id+"_destroyed",JSON.stringify(this._destroyed))},configureStorage:function(){switch(this.options.source){case "local":case "localStorage":this.options.storage=
"localStorage";break;case "session":case "sessionStorage":this.options.storage="sessionStorage"}switch(this.options.storage||""){case "local":case "localStorage":this.options.storage="localStorage";break;case "session":case "sessionStorage":this.options.storage="sessionStorage";break;default:return}this.options.type=this.options.type||this.options.storage;this.options.storage=window[this.options.storage];this.bind("requestEnd",function(a){if("read"===a.type)this.one("change",function(a){pi.data.DataSource.setGUID.apply(this,
arguments)})});var a=this.options.storage.getItem(this.options.id);!this.data().length&&a&&this.reset(JSON.parse(a));for(var b=0,a=this.data();b<a.length;b++)a[b].guid?a[b].uid=a[b].guid:a[b].guid=a[b].uid;if(a=this.options.storage.getItem(this.options.id+"_destroyed"))this._destroyed=new kendo.data.ObservableArray(JSON.parse(a));this.bind("change",function(a){pi.data.DataSource.storeData.apply(this,arguments)})},configureSelected:function(){this.options.selected||(this.options.selected="first");
switch(this.options.selected){case "first":case "last":this.options.defaultSelected=this.options.selected;break;default:this.options.defaultSelected="first"}var a=this;this.bind("requestEnd",function(b){a.one("change",function(a){a=this.options.get("selected");a instanceof kendo.data.ObservableObject&&a.uid&&this.options.set("selected",this.getByUid(a.uid))})});this.bind("change",function(a){var c=this.options.get("selected");"remove"==a.action&&c instanceof kendo.data.ObservableObject&&c.uid&&!this.getByUid(c.uid)&&
this.options.set("selected",this.options.get("defaultSelected","first"))});this.options.bind("get",function(b){b.value=this[b.field];"selected"!==b.field||b.value instanceof kendo.data.ObservableObject||("undefined"==typeof b.value&&(b.value=this.defaultSelected),"undefined"==typeof b.value&&(b.value="first"),a.view().length&&("first"==b.value?b.value=0:"last"==b.value&&(b.value=a.view().length-1),"number"==typeof b.value?this.set("selected",a.view()[b.value]):"string"==typeof b.value&&this.set("selected",
a.get(b.value))))})},configureDefault:function(){this.options["default"]&&this.bind("change",function(a){this.data().length||this.add($.extend({},this.options["default"].toJSON?this.options["default"].toJSON():this.options["default"]))}).trigger("change",{action:"init"})}};kendo.data.DataSource.prototype.reset=function(a){for(this.data(a||[]);this._destroyed.length;)this._destroyed.pop();this.options.set("selected",this.options.get("defaultSelected","first"));this.options.get("selected");return this};
pi.ui=pi.ui||{};
pi.ui.List={init:function(a,b){pi.ui.Widget.attributeOptions.apply(this,arguments);!b.dataSource||b.dataSource instanceof kendo.data.DataSource||("string"===typeof b.dataSource?(b.dataSource=$.extend({source:b.dataSource},b),delete b.dataSource.dataSource,delete b.dataSource.bind,delete b.dataSource.exists):b.dataSource.toJSON?b.dataSource=b.dataSource.toJSON():b.dataSource instanceof Array&&(b.dataSource={data:b.dataSource}),!b.dataSource||b.template||b.schema&&b.schema.model||(b.dataSource.template=$(a)),
b.dataSource=pi.data.DataSource.create(b.dataSource));b.dataSource&&"everlive"==b.dataSource.options.type&&(void 0==b.dataValueField&&(b.dataValueField="uid"),void 0!=b.valuePrimitive||"uid"!=b.dataValueField&&"Id"!=b.dataValueField||(b.valuePrimitive=!0));"undefined"==typeof b.value&&(b.index=0)},configureFields:function(a,b){!b.dataSource.fields&&b.dataSource.options.fields&&(b.dataSource.fields=b.dataSource.options.fields)}};
kendo.ui.Select&&(pi.ui.Select=kendo.ui.Select,kendo.ui.Select=pi.ui.Select.extend({init:function(a,b){pi.ui.List.init.apply(this,arguments);pi.ui.Select.fn.init.apply(this,arguments);pi.ui.List.configureFields.apply(this,arguments)}}),kendo.ui.roles.select=kendo.ui.Select);
kendo.ui.MultiSelect&&(pi.ui.MultiSelect=kendo.ui.MultiSelect,kendo.ui.MultiSelect=pi.ui.MultiSelect.extend({init:function(a,b){pi.ui.List.init.apply(this,arguments);pi.ui.MultiSelect.fn.init.apply(this,arguments);pi.ui.List.configureFields.apply(this,arguments)}}),kendo.ui.roles.multiselect=kendo.ui.MultiSelect);
kendo.ui.DropDownList&&(pi.ui.DropDownList=kendo.ui.DropDownList,kendo.ui.DropDownList=pi.ui.DropDownList.extend({init:function(a,b){pi.ui.List.init.apply(this,arguments);pi.ui.DropDownList.fn.init.apply(this,arguments);pi.ui.List.configureFields.apply(this,arguments)},readonly:function(a){pi.ui.DropDownList.fn.readonly.apply(this,arguments);this._readonly=a}}),kendo.ui.roles.dropdownlist=kendo.ui.DropDownList);
kendo.ui.AutoComplete&&(pi.ui.AutoComplete=kendo.ui.AutoComplete,kendo.ui.AutoComplete=pi.ui.AutoComplete.extend({init:function(a,b){pi.ui.List.init.apply(this,arguments);pi.ui.AutoComplete.fn.init.apply(this,arguments);pi.ui.List.configureFields.apply(this,arguments)},readonly:function(a){pi.ui.AutoComplete.fn.readonly.apply(this,arguments);this._readonly=a}}),kendo.ui.roles.autocomplete=kendo.ui.AutoComplete);
kendo.ui.ComboBox&&(pi.ui.ComboBox=kendo.ui.ComboBox,kendo.ui.ComboBox=pi.ui.ComboBox.extend({init:function(a,b){pi.ui.List.init.apply(this,arguments);pi.ui.ComboBox.fn.init.apply(this,arguments);pi.ui.List.configureFields.apply(this,arguments)},readonly:function(a){pi.ui.ComboBox.fn.readonly.apply(this,arguments);this._readonly=a}}),kendo.ui.roles.combobox=kendo.ui.ComboBox);pi=pi||{};pi.mobile=pi.mobile||{};pi.mobile.ui=pi.mobile.ui||{};pi.mobile.ui.Button=kendo.mobile.ui.Button;
kendo.mobile.ui.Button=pi.mobile.ui.Button.extend({init:function(a,b){pi.mobile.ui.Button.fn.init.apply(this,arguments);kendo.support.mobileOS&&kendo.support.mobileOS.android&&400>kendo.support.mobileOS.flatVersion&&this.element.kendoTouch({tap:this.touchClick})},touchClick:function(a){a.event&&a.event.target&&(console.log("Transfering touch event to click handler."),$(a.event.target).trigger("click"))}});kendo.mobile.ui.roles.button=kendo.mobile.ui.Button;pi=pi||{};pi.mobile=pi.mobile||{};
pi.mobile.ui=pi.mobile.ui||{};pi.mobile.ui.ModalView=kendo.mobile.ui.ModalView;kendo.mobile.ui.ModalView=pi.mobile.ui.ModalView.extend({init:function(a,b){pi.mobile.ui.ModalView.fn.init.apply(this,arguments);this.options=pi.observable(this.options);kendo.bind(this.element,this.options);var c=this;this.element.find("[type=submit],[type=reset]").each(function(a,b){$(this).data("kendoMobileButton").bind("click",function(a){a.preventDefault();c.close()})})}});kendo.mobile.ui.roles.modalview=kendo.mobile.ui.ModalView;
pi=pi||{};pi.ui=pi.ui||{};pi.ui.Validator=kendo.ui.Validator;
kendo.ui.Validator=pi.ui.Validator.extend({init:function(a,b){$(a).removeAttr("data-role");b=b||{};pi.ui.List.init.call(this,a,b);pi.ui.Validator.fn.init.call(this,a,b);b=this.options;"false"!=this.options.autoBind&&(this.bindValues(this.element,this.options),this.configureSelected(this.element,this.options),this.options=b);return this},setOptions:function(a){pi.ui.Widget.attributeOptions.call(this,this.element,a);pi.ui.Validator.fn.setOptions.apply(this,arguments)},bindValues:function(a,b){this.options.dataSource&&
$(a).find(":input[name],:input[data-name],div[data-name],span[data-name]").each(function(a,b){b=$(b);if(!b.attr("data-bind")){var f=b.attr("data-name")||b.attr("name");switch((b.attr("data-type")||b.attr("type")||b.prop("tagName")).toLowerCase()){case "radio":case "checkbox":case "switch":b.attr("data-bind","checked:"+f);break;case "textarea":case "editor":b.attr("data-bind","text:"+f);break;case "buttongroup":b.attr("data-bind","index:"+f);break;case "tabstrip":b.attr("data-bind","selectedIndex:"+
f);break;default:b.attr("data-bind","value:"+f)}}})},configureSelected:function(a,b){if(this.options.dataSource){var c=$(a),d=this;this.options.dataSource.options.bind("change",function(a){switch(a.field){case "selected":a.value=this.get(a.field),kendo.mobile?kendo.bind(c.children(),a.value,kendo.mobile.ui,kendo.ui):kendo.bind(c.children(),a.value,kendo.ui),d.hideMessages()}})}},validateInput:function(a){var b=pi.ui.Validator.fn.validateInput.apply(this,arguments);kendo.support.mobileOS&&kendo.support.mobileOS.android&&
400>kendo.support.mobileOS.flatVersion&&this.hideMessages();return b}});kendo.ui.roles.validator=kendo.ui.Validator;
$(function(){$("form[data-storage],form[data-source]").each(function(a,b){var c=$(this);c.attr("data-role")||c.attr("data-role","validator");"false"!=c.attr("data-auto-submit")&&(c.bind("submit",function(a){if((a=c.data("kendoValidator"))&&a.validate()&&a.options.dataSource){switch(c.attr("method")){case "get":a.options.dataSource._dequeueRequest();a.options.dataSource.read();break;case "delete":a.options.dataSource.remove(a.options.dataSource.options.get("selected"));default:a.options.dataSource.hasChanges()&&
a.options.dataSource.sync()}return!1}}),c.bind("keyup",function(a){13==a.keyCode&&"TEXTAREA"!=$(a.target).prop("tagName").toUpperCase()&&(c.find(":input").blur(),c.trigger("submit"))}));c.bind("keyup",function(a){27==a.keyCode&&a.target&&$(a.target).blur()})})});kendo.ui.ColorPicker.fn.options.tileSize=14;pi=pi||{};pi.mobile=pi.mobile||{};pi.mobile.ui=pi.mobile.ui||{};pi.mobile.ui.ListView=kendo.mobile.ui.ListView;
kendo.mobile.ui.ListView=pi.mobile.ui.ListView.extend({init:function(a,b){pi.ui.Widget.attributeOptions.apply(this,arguments);this._configure(a,b);pi.mobile.ui.ListView.fn.init.apply(this,arguments)},_configure:function(a,b){if("undefined"!=typeof b.dataSource&&"undefined"==typeof b.template){var c=$(a),d;"UL"==c.prop("tagName").toUpperCase()?(c=c.children("li").first(),d=c.children("ul"),d.length?(d.detach(),b.headerTemplate=c.html(),b.template=d.children("li").html()):b.template=c.html()):b.template=
c.html()}}});kendo.mobile.ui.roles.listview=kendo.mobile.ui.ListView;pi=pi||{};pi.ui=pi.ui||{};pi.ui.Grid=kendo.ui.Grid;
kendo.ui.Grid=pi.ui.Grid.extend({_attributeTemplateRegEx:/#=?([^#]*)#/,init:function(a,b){this.element=$(a);pi.ui.Widget.attributeOptions.apply(this,arguments);pi.ui.List.init.apply(this,arguments);this._configureGrid(a,b);b.dataSource&&(this.dataSource=b.dataSource);b.columns&&(this.columns=b.columns);this.element.removeAttr("data-role");pi.ui.Grid.fn.init.apply(this,arguments)},attr:function(a,b,c){if("string"==typeof a){if(!this.element)return;c=b;b=a;a=this.element}return this._eval($(a).attr(b))||
c},_eval:pi.ui.Widget.attributeTemplate,_configureGrid:function(a,b){var c=this,d=$(a),f;defaults={pageable:void 0==b.pageSize?!1:!0,navigatable:!0,editable:!0,filterable:!0,sortable:!0,columnMenu:!0,resizable:!0,mobile:kendo.support.mobileOS?"phone":!1};for(var g in defaults)void 0==b[g]&&(b[g]=defaults[g]);b.columns=[];f=d.find("thead tr th");d.find("tbody tr td").each(function(a,d){if(a<f.length)var g=f.eq(a);var e={index:a,title:c._eval(g.html()),width:c.attr(d,"data-width")||c.attr(d,"width")||
(g?c.attr(g,"data-width")||c.attr(g,"width"):null)},m=$(d).find("input[type=edit],input[type=destroy],input[type=button],button");if(m.length)e.command=[],m.each(function(a,b){var c;switch(c=$(b).attr("type")){case "delete":c="destroy"}e.command.push(c)});else{var h=$(d).find(":input[name],:input[data-name]");if(1==h.length)if(e.field=c.attr(h,"data-name")||c.attr(h,"name")||(g?c.attr(g,"data-name"):null),e.type=c.attr(h,"data-type")||c.attr(h,"type")||(g?c.attr(g,"data-type"):null),e.format=c.attr(h,
"data-format")||c.attr(h,"format")||(g?c.attr(g,"data-format"):null),e.role=c.attr(h,"data-role"))switch(e.kendoEditor=kendo.initWidget(h.attr("data-role",e.role.toLowerCase())),e.editor=function(a,b){kendo.initWidget(h.clone().attr("data-role",e.role.toLowerCase()).appendTo(a))},e.role){case "ColorPicker":e.template=function(a){a=a[e.field];return"string"==typeof a&&a.length?'<div class="k-colorpalette"><div class="k-item" style="background-color:'+a+'">&nbsp;</div></div>':""};break;default:e.template=
function(a){var b,c,d=[];a=a[e.field];if(!(a instanceof kendo.data.ObservableArray))return a||"";if(void 0==e.kendoEditor.options.dataValueField||void 0==e.kendoEditor.options.dataTextField||e.kendoEditor.options.dataValueField==e.kendoEditor.options.dataTextField)return a.join(", ");if("id"==e.kendoEditor.options.dataValueField||"Id"==e.kendoEditor.options.dataValueField||void 0!=e.kendoEditor.options.dataValueField&&void 0!=e.kendoEditor.dataSource.schema&&void 0!=e.kendoEditor.dataSource.schema.model&&
e.kendoEditor.dataSource.schema.model.id==e.kendoEditor.options.dataValueField)b=e.kendoEditor.options.dataValueField;for(var f=0;f<a.length;f++){if(b)c=e.kendoEditor.dataSource.get(a[f]);else for(var g=0;g<e.kendoEditor.dataSource.total()&&(c=e.kendoEditor.dataSource.at(g),c[e.kendoEditor.options.dataValueField]!=a[f]);g++)delete c;c instanceof kendo.data.ObservableObject&&(d[f]=c.get(e.kendoEditor.options.dataTextField));void 0==d[f]&&(d[f]="")}return d.join(", ")}}else delete e.role;else e.editor=
function(a,b){return b.element.clone().appendTo(a)}}e.field||delete e.field;e.width||delete e.width;e.type||delete e.type;if(e.format)switch(e.type){case "date":case "datetime":case "time":case "number":"{"!=e.format.substr(0,1)&&(e.format="{0:"+e.format+"}");break;default:"function"==typeof window[e.format]&&(e.format=window[e.format])}else delete e.format;b.columns[a]=e})}});kendo.ui.roles.grid=kendo.ui.Grid;pi=pi||{};pi.ui=pi.ui||{};pi.ui.Touch=kendo.ui.Touch;
kendo.ui.Touch=pi.ui.Touch.extend({init:function(a,b){pi.ui.Touch.fn.init.apply(this,arguments);b.enableSwipe&&(this.events.bind("start",$.proxy(this,"_vswipestart")),this.events.bind("move",$.proxy(this,"_vswipemove")))},_vswipestart:function(a){2*Math.abs(a.y.velocity)>=Math.abs(a.x.velocity)&&a.sender.capture()},_vswipemove:function(a){var b=this.options,c=a.touch,d=a.event.timeStamp-c.startTime,f=0<c.y.initialDelta?"down":"up";Math.abs(c.y.initialDelta)>=b.minXDelta&&Math.abs(c.x.initialDelta)<
b.maxYDelta&&d<b.maxDuration&&(this.trigger("swipe",{direction:f,touch:a.touch}),c.cancel())}});kendo.ui.roles.touch=kendo.ui.Touch;kendo.ui.plugin(kendo.ui.Touch);pi=pi||{};pi.mobile=pi.mobile||{};pi.mobile.ui=pi.mobile.ui||{};kendo.data.binders.widget.attr||(kendo.data.binders.widget.attr=kendo.data.Binder.extend({init:function(a,b,c){kendo.data.Binder.fn.init.call(this,a.element[0],b,c);this.widget=a},refresh:kendo.data.binders.attr.fn.refresh}));
pi.mobile.ui.PhotoUpload=kendo.ui.Widget.extend({dirty:!1,init:function(a,b){pi.ui.Widget.attributeOptions.apply(this,arguments);this.initDatasource(a,b);this.setMaxSize(a,b);kendo.ui.Widget.fn.init.apply(this,arguments);this.options=pi.observable(this.options);this.render(a,b);$(a).data("kendoPhotoUpload",this)},src:function(a){try{if(a||""===a)this._uri=a,this.img.attr("src",1E3>a.length?a:"data:image/jpeg;base64,"+a);else return this._uri||this.img.attr("src")}catch(b){b.event="Handle File Source",
(pi||console).log(b,"error")}},value:function(a){var b,c,d=this.element.attr("data-bind"),f=this.element.attr("data-type")||"string";try{d&&(b=(c=JSON.parse(d.replace(/\b(\w+)\b\s*:/g,'"$1":').replace(/:\s*\b([\w\.]+)\b/g,':"$1"').replace(/^\s*{?(.*)}?\s*$/,"{$1}")))&&c.value?c.value:d)}catch(g){b=d}b=b.split(".").pop();if(a||""===a)this._value=a,"object"===typeof a&&b?this.input.val(a[b]||""):this.input.val(a);else return"object"===f?this._value:"object"===typeof this._value&&b?this._value[b]:this._value||
this.input.val()},initDatasource:function(a,b){if(b.dataSource&&"string"===typeof b.dataSource&&"everlive.files"===b.dataSource.toLowerCase()){b.name=b.name||$(a).attr("data-name")||$(a).attr("name")||"file";if(!b.maxSize||4E6<b.maxSize)b.maxSize=4E6;var c=this;b.autoUpload||(this.form=$(a).parents("form").bind("submit",function(a){return c.dirty?(c.uploadFile(),!1):!0}))}},setMaxSize:function(a,b){b.maxSize&&(b.maxSizeString=1E9<b.maxSize?Math.floor(100*b.maxSize/1E9)/100+"GB":1E6<b.maxSize?Math.floor(100*
b.maxSize/1E6)/100+"MB":1E3<b.maxSize?Math.floor(100*b.maxSize/1E3)/100+"KB":b.maxSize+" Bytes")},render:function(a,b){var c=this;this.element=$(a);this.element.is("div")||this.element.is("span")?this.wrap=this.element.addClass("km-photo-upload"):this.wrap=this.element.wrap('<div class="km-photo-upload">').parent();this.element.is("input")&&(this.input=this.element,"image"===this.element.attr("type")&&(this.img=this.element),"file"===this.element.attr("type")&&(this.file=this.element));this.element.is("img")&&
(this.img=this.element);this.img||(this.img=$("<img>").appendTo(this.wrap).attr("src",this.element.attr("src")||this.element.attr("value")||""));this.input||(this.input=$('<input type="image" name="'+b.name+'" />').appendTo(this.wrap),this.input.attr("value",this.element.attr("value")).attr("src",this.element.attr("src")),this.element.attr("data-bind")&&(this.input.attr("data-bind",this.element.attr("data-bind")),this.element.removeAttr("data-bind")));if(navigator.camera){this.file&&this.file.hide();
var d={destinationType:Camera.DestinationType.DATA_URL,mediaType:Camera.MediaType.PICTURE,encodingType:Camera.EncodingType.JPEG,correctOrientation:!0};this.options.width&&(d.targetWidth=parseInt(this.options.width));this.options.height&&(d.targetHeight=parseInt(this.options.height));this.options.quality&&(d.quality=parseInt(this.options.quality));this.cameraButton=$("<button>Camera</button>").appendTo(this.wrap).kendoMobileButton({icon:"camera",click:function(a){navigator.camera.getPicture(function(){c.selectSuccess.apply(c,
arguments)},function(){c.selectError.apply(c,arguments)},$.extend({sourceType:Camera.PictureSourceType.CAMERA},d))}});this.libraryButton=$("<button>Photos</button>").appendTo(this.wrap).kendoMobileButton({icon:"organize",click:function(a){navigator.camera.getPicture(function(){c.selectSuccess.apply(c,arguments)},function(){c.selectError.apply(c,arguments)},$.extend({sourceType:Camera.PictureSourceType.PHOTOLIBRARY},d))}});this.deleteButton=$("<button>Delete</button>").appendTo(this.wrap).kendoMobileButton({icon:"delete",
click:function(a){c.uploadSuccess("")}})}else this.file||(this.file=$('<input type="file" />').appendTo(this.wrap)),this.file.bind("change",function(a){c.selectSuccess($(this).val())})},selectSuccess:function(a){this.options.maxSize&&(a.length>this.options.maxSize||this.file&&this.file[0].files.length&&this.file[0].files[0].size>this.options.maxSize)?this.trigger("error",{message:"The file selected is larger than "+this.options.maxSizeString+". Please select another."}):(this._uri!==a&&(this.dirty=
!0),this._uri=a,this.src(a),this.trigger("change",{src:a}),this.autoupload&&this.dirty&&this.uploadFile())},selectError:function(a){(pi||console).log(a)},uploadFile:function(){var a=this;if(this.dirty)if(this._uri&&1E3<this._uri.length)a=this,Everlive.$.Files.create({Filename:"photo.jpg",ContentType:"image/jpeg",base64:this._uri},function(b){b.result?a.uploadSuccess(b.result):(pi||console).log("Unknown result: "+JSON.stringify(b))},this.uploadError);else if(this._uri){var a=this,b=new FileUploadOptions,
c=new FileTransfer;b.fileName=this._uri.split("/").pop();b.headers=Everlive.$.buildAuthHeader();switch(b.fileName.split(".").pop()){case "jpg":case "jpeg":b.mimetype="image/jpeg";break;case "png":b.mimetype="image/png";break;case "gif":b.mimetype="image/gif";break;default:return}c.upload(this._uri,Everlive.$.Files.getUploadUrl(),function(b){var c=JSON.parse(b.response);c.Result&&c.Result.length?a.uploadSuccess(c.Result[0]):(pi||console).log("Unknown result: "+b.response)},a.uploadError,b)}},uploadSuccess:function(a){try{var b=
this.value();this.dirty=!1;b&&b.Id&&Everlive.$.Files.destroySingle({Id:b.Id});this.value(a);this._uri=a.Uri?a.Uri:a.src?a.src:"";this.src(this._uri);this.trigger("change",{src:this.src(),value:this.value()});!this.options.autoUpload&&this.form&&this.form.trigger("submit")}catch(c){c.event="Photo Upload Post-Processing",(pi||console).log(c,"error")}},uploadError:function(a){var b={event:"Photo Upload Error",message:a.message||"Photo Upload Error"};a.body&&(a.body=JSON.parse(a.body),b.code=a.body.code,
b.message=a.body.message);if("undefined"!=typeof FileTransferError)switch(b.code){case FileTransferError.FILE_NOT_FOUND_ERR:b.message=templates.postcards.fields.sent.upload.missing;break;case FileTransferError.INVALID_URL_ERR:b.message="INVALID_URL_ERR"}(pi||console).log(b,"error")}});kendo.mobile.ui.roles.photoupload=pi.mobile.ui.PhotoUpload;